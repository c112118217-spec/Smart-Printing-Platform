<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§å°åˆ·å¹³å° | æ™ºæ…§å°åˆ·å¹³å°</title>
    <style>
        /* --- CSS è®Šæ•¸ --- */
        :root {
            --primary: #0056b3;
            --secondary: #00a8cc;
            --bg: #f4f7f6;
            --text: #333;
            --danger: #dc3545;
            --success: #28a745;
            --card-shadow: 0 5px 15px rgba(0,0,0,0.08);
            --modal-bg: rgba(0,0,0,0.85);
        }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.6; }
        
        /* --- Header --- */
        header { background: white; padding: 1rem 5%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: bold; color: var(--primary); cursor: pointer; }
        .nav-links { display: flex; gap: 20px; }
        .nav-item { cursor: pointer; font-weight: bold; color: #666; transition: 0.2s; }
        .nav-item:hover { color: var(--primary); }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .cart-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; position: relative; }
        .cart-badge { position: absolute; top: -5px; right: -8px; background: var(--danger); color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 50%; }
        .user-info { font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 10px; }

        .container { max-width: 1100px; margin: 2rem auto; padding: 0 20px; padding-bottom: 60px; }

        /* --- Auth --- */
        .auth-container { max-width: 450px; margin: 50px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: var(--card-shadow); text-align: center; }
        .auth-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #eee; }
        .auth-tab { flex: 1; padding: 10px; cursor: pointer; color: #666; font-weight: bold; }
        .auth-tab.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
        .auth-form input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .auth-help { margin-top: 15px; font-size: 0.9rem; color: #666; }

        /* --- Components --- */
        .hidden-section { display: none; animation: fadeIn 0.3s; }
        .back-btn { background: none; border: none; color: #666; cursor: pointer; font-size: 1rem; margin-bottom: 1rem; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 15px; font-size: 1.1rem; }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; }
        
        /* --- Home --- */
        .mode-selection { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 3rem; }
        .mode-card { background: white; padding: 2.5rem; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px solid transparent; box-shadow: var(--card-shadow); }
        .mode-card:hover { transform: translateY(-10px); border-color: var(--primary); }

        /* --- Library --- */
        .library-section { background: white; padding: 40px; border-radius: 15px; box-shadow: var(--card-shadow); }
        .library-tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .lib-tab { padding: 8px 20px; cursor: pointer; border-radius: 20px; font-weight: bold; background: #eee; color: #666; border: none; transition:0.2s; }
        .lib-tab.active { background: var(--primary); color: white; }
        .spec-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .spec-card { border: 1px solid #eee; border-radius: 10px; padding: 20px; transition: 0.3s; background: white; position: relative; overflow: hidden; }
        .spec-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: var(--secondary); }
        .texture-demo { height: 100px; border-radius: 8px; margin-bottom: 15px; position: relative; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: rgba(0,0,0,0.5); font-weight: bold; border: 1px solid #ddd; }
        .tex-glossy { background: linear-gradient(135deg, #fff 0%, #eee 50%, #fff 100%); }
        .tex-matte { background: #f0f0f0; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); }
        .tex-kraft { background: #d2b48c; }
        .tex-pearl { background: linear-gradient(45deg, #fff0f5, #e6e6fa); }
        .spec-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .spec-desc { font-size: 0.9rem; color: #666; margin-bottom: 15px; min-height: 50px; }
        .use-btn { width: 100%; padding: 8px; background: white; border: 1px solid var(--primary); color: var(--primary); border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .use-btn:hover { background: var(--primary); color: white; }

        /* --- Order Form --- */
        .form-container { background: white; padding: 2rem; border-radius: 15px; box-shadow: var(--card-shadow); }
        .form-section-title { border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 20px; color: var(--primary); font-size: 1.1rem; font-weight: bold; margin-top: 20px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        optgroup { color: var(--primary); font-weight: bold; }
        .upload-area { border: 2px dashed #ccc; padding: 30px; text-align: center; border-radius: 10px; margin-top: 20px; cursor: pointer; position: relative; }
        .upload-area:hover { border-color: var(--primary); background: #f0f8ff; }
        .file-input { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        .status-box { margin-top: 15px; padding: 10px; border-radius: 5px; font-size: 0.9rem; display: none; text-align: left; }
        .status-ok { background: #d4edda; color: #155724; }
        .price-box { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; text-align: right; border-left: 5px solid var(--primary); margin-top: 2rem; }
        .total-price { font-size: 2rem; color: #d9534f; font-weight: bold; }

        /* --- Chat --- */
        .chat-interface { background: white; border-radius: 15px; height: 550px; display: flex; flex-direction: column; padding: 20px; box-shadow: var(--card-shadow); }
        .chat-window { flex: 1; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .message { margin-bottom: 15px; max-width: 80%; padding: 12px 18px; border-radius: 15px; display: inline-block; word-wrap: break-word; }
        .bot { background: #e9ecef; float: left; } .user { background: var(--primary); color: white; float: right; }
        .chat-options { text-align: right; margin-top: 10px; }
        .option-btn { border: 1px solid var(--primary); background: white; color: var(--primary); padding: 8px 15px; border-radius: 20px; cursor: pointer; margin: 5px; transition:0.2s; }
        .option-btn:hover { background: var(--primary); color: white; }

        /* --- Checkout & Admin --- */
        .checkout-view { background: white; padding: 40px; border-radius: 15px; box-shadow: var(--card-shadow); max-width: 800px; margin: 0 auto; }
        .order-summary { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #ddd; padding-bottom: 10px; }
        .summary-total { font-size: 1.2rem; font-weight: bold; text-align: right; color: var(--danger); margin-top: 15px; border-top: 2px solid #eee; padding-top: 15px; }
        .selection-card-group { display: flex; gap: 15px; margin-bottom: 20px; }
        .selection-card { flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 10px; cursor: pointer; text-align: center; transition: 0.2s; background: white; }
        .selection-card:hover, .selection-card.active { border-color: var(--primary); background: #e3f2fd; font-weight: bold; color: var(--primary); }
        
        .dashboard-container { background: white; padding: 30px; border-radius: 15px; box-shadow: var(--card-shadow); }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .admin-tab { padding: 8px 20px; cursor: pointer; background: #eee; border-radius: 5px; font-weight: bold; }
        .admin-tab.active { background: var(--primary); color: white; }
        .order-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .order-table th, .order-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        .order-table th { background: #f8f9fa; color: var(--primary); }
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; display: inline-block; }
        .status-new { background: #e3f2fd; color: #0d47a1; }
        .status-processing { background: #fff3cd; color: #856404; }
        .status-done { background: #d4edda; color: #155724; }
        .status-select { padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
        .delete-btn { background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .footer-admin-link { position: fixed; bottom: 10px; right: 10px; color: #ccc; text-decoration: none; font-size: 0.8rem; }

        /* Modal & Sidebar */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-bg); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; width: 90%; max-width: 800px; height: 85vh; border-radius: 15px; display: flex; flex-direction: column; overflow: hidden; }
        .preview-container { position: relative; width: 100%; max-width: 600px; height: 100%; min-height: 400px; border: 1px solid #ddd; background: #eee; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .preview-img { max-width: 100%; max-height: 100%; display: none; }
        .preview-pdf { width: 100%; height: 100%; border: none; display: none; }
        .cart-sidebar { position: fixed; top: 0; right: -400px; width: 350px; height: 100%; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); transition: 0.3s; z-index: 2000; padding: 20px; display: flex; flex-direction: column; }
        .cart-sidebar.open { right: 0; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="auth-view" style="display:block;">
        <div class="container" style="padding-top:50px;">
            <div style="text-align:center; margin-bottom:30px;">
                <h1 style="color:var(--primary); font-size:2.5rem;">CMYKB æ™ºæ…§å°åˆ·</h1>
                <p>Welcome! è«‹å…ˆç™»å…¥æˆ–è¨»å†Š</p>
            </div>
            <div class="auth-container">
                <div class="auth-tabs"><div id="tab-login" class="auth-tab active" onclick="toggleAuth('login')">ç™»å…¥</div><div id="tab-register" class="auth-tab" onclick="toggleAuth('register')">è¨»å†Š</div></div>
                <div id="form-login" class="auth-form">
                    <input type="text" id="login-user" placeholder="å¸³è™Ÿ">
                    <input type="password" id="login-pass" placeholder="å¯†ç¢¼">
                    <button class="btn-primary" onclick="login()">ç™»å…¥</button>
             
                    
                </div>
                <div id="form-register" class="auth-form" style="display:none;">
                    <input type="text" id="reg-user" placeholder="è¨­å®šå¸³è™Ÿ">
                    <input type="password" id="reg-pass" placeholder="è¨­å®šå¯†ç¢¼">
                    <div style="border-top:1px dashed #ddd; margin:15px 0;"></div>
                    <input type="text" id="reg-name" placeholder="çœŸå¯¦å§“å (å¿…å¡«)">
                    <input type="text" id="reg-phone" placeholder="é›»è©± (09xxxxxxxx)">
                    <input type="email" id="reg-email" placeholder="Email">
                    <button class="btn-primary" onclick="register()">è¨»å†Š</button>
                </div>
                <p id="auth-msg" style="color:red; margin-top:10px; display:none;"></p>
            </div>
        </div>
    </div>

    <div id="app-view" style="display:none;">
        <header>
            <div class="logo" onclick="switchView('home')">CMYKB</div>
            <div class="nav-links">
                <div class="nav-item" onclick="switchView('order')">ä¸‹å–®ä¸­å¿ƒ</div>
                <div class="nav-item" onclick="switchView('library')">å°ºå¯¸&æè³ª</div>
            </div>
            <div class="header-actions">
                <div class="user-info"><span id="display-username">User</span><button onclick="switchView('my-orders')" style="background:none; border:1px solid #ccc; border-radius:15px; padding:2px 10px; cursor:pointer;">ğŸ‘¤ è¨‚å–®</button><button onclick="logout()" style="background:none; border:none; cursor:pointer; color:#666;">ç™»å‡º</button></div>
                <button class="cart-btn" onclick="toggleCart()">ğŸ›’ <span class="cart-badge" id="cart-count">0</span></button>
            </div>
        </header>

        <div class="container">
            <div id="home-view">
                <h2 style="text-align:center;">æ‚¨ä»Šå¤©éœ€è¦ä»€éº¼æœå‹™ï¼Ÿ</h2>
                <div class="mode-selection">
                    <div class="mode-card" onclick="startWizard()"><div style="font-size:3rem;">ğŸ’¬</div><h3>AI æ™ºæ…§å°å¼•</h3><p>ä¸‰æ­¥é©Ÿç²¾æº–æ¨è–¦</p></div>
                    <div class="mode-card" onclick="switchView('library')"><div style="font-size:3rem;">ğŸ“š</div><h3>æè³ªåœ–é‘‘</h3><p>ç€è¦½è±å¯Œè¦æ ¼èˆ‡åŠ å·¥</p></div>
                    <div class="mode-card" onclick="startExpert()"><div style="font-size:3rem;">ğŸ› ï¸</div><h3>ç›´æ¥ä¸‹å–®</h3><p>è¦æ ¼é½Šå…¨ (A0-A5)</p></div>
                </div>
            </div>

            <div id="library-view" class="hidden-section">
                <h2 style="text-align:center;">æè³ªèˆ‡è¦æ ¼åœ–é‘‘</h2>
                <div class="library-section">
                    <div class="library-tabs">
                        <button class="lib-tab active" onclick="filterLib('size')">ç´™å¼µå°ºå¯¸</button>
                        <button class="lib-tab" onclick="filterLib('material')">ç´™å¼µæè³ª</button>
                        <button class="lib-tab" onclick="filterLib('finish')">å¾ŒåŠ å·¥</button>
                    </div>
                    <div id="lib-content" class="spec-grid"></div>
                </div>
                <button class="back-btn" onclick="switchView('home')" style="display:block; margin:20px auto;">è¿”å›é¦–é </button>
            </div>

            <div id="wizard-mode" class="hidden-section">
                <button class="back-btn" onclick="switchView('home')">â† è¿”å›</button>
                <div class="chat-interface">
                    <div id="chat-window" class="chat-window"><div class="message bot">ä½ å¥½ï¼æˆ‘æ˜¯å°åˆ·å°å¹«æ‰‹ã€‚<br><b>Q1. è«‹å•æ‚¨çš„å°åˆ·ç”¨é€”æ˜¯ï¼Ÿ</b></div></div>
                    <div id="chat-options" class="chat-options"><button class="option-btn" onclick="wizardStep(1, 'flyer')">ç™¼å‚³å–®</button><button class="option-btn" onclick="wizardStep(1, 'poster')">è²¼æµ·å ±</button><button class="option-btn" onclick="wizardStep(1, 'book')">åšæ›¸æœ¬</button><button class="option-btn" onclick="wizardStep(1, 'card')">æ›åç‰‡</button></div>
                </div>
            </div>

            <div id="expert-mode" class="hidden-section">
                <div class="form-container">
                    <h2 style="color:var(--primary); margin-top:0;">è©³ç´°è¦æ ¼ä¸‹å–®</h2>
                    <div class="form-grid">
                        <div class="form-group"><label>1. ç´™å¼µå°ºå¯¸</label><select class="form-control" id="ex-size" onchange="calcPrice()"><optgroup label="å¸¸ç”¨ A ç³»åˆ—"><option value="A4">A4 (æ–‡ä»¶)</option><option value="A3">A3 (æµ·å ±)</option><option value="A5">A5 (å‚³å–®)</option><option value="A2">A2 (å¤§å‹)</option></optgroup><optgroup label="B ç³»åˆ—"><option value="B4">B4 (è©¦å·)</option><option value="B5">B5 (æ›¸ç±)</option><option value="B3">B3 (æµ·å ±)</option></optgroup><optgroup label="å¤§åœ–/ç‰¹æ®Š"><option value="A1">A1 (å¤§åœ–)</option><option value="A0">A0 (å…¨é–‹)</option><option value="Postcard">æ˜ä¿¡ç‰‡</option><option value="Envelope">ä¿¡å°</option></optgroup><optgroup label="å…¶ä»–"><option value="NameCard">åç‰‡ (ä¸€ç›’)</option></optgroup></select></div>
                        <div class="form-group"><label>2. é¡è‰²</label><select class="form-control" id="ex-color" onchange="calcPrice()"><option value="bw">é»‘ç™½</option><option value="color">å½©è‰²</option></select></div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label>3. æè³ª</label><select class="form-control" id="ex-material" onchange="calcPrice()"><optgroup label="ä¸€èˆ¬ç”¨ç´™"><option value="plain">æ™®é€šå½±å°ç´™</option><option value="woodfree">é“æ—ç´™</option></optgroup><optgroup label="å¡—ä½ˆ/å¡ç´™"><option value="glossy">éŠ…ç‰ˆç´™ (äº®)</option><option value="matte">é›ªéŠ…ç´™ (éœ§)</option><option value="card_copper">éŠ…è¥¿å¡ (åš)</option><option value="ivory">è±¡ç‰™å¡</option><option value="kraft">ç‰›çš®ç´™</option><option value="pearl">æ˜Ÿå¹»ç´™</option><option value="pp">PPåˆæˆç´™ (é˜²æ°´)</option></optgroup><optgroup label="è²¼ç´™é¡"><option value="sticker_mold">æ¨¡é€ è²¼ç´™</option><option value="sticker_glossy">éŠ…ç‰ˆè²¼ç´™</option><option value="sticker_trans">é€æ˜è²¼ç´™</option></optgroup></select></div>
                        <div class="form-group"><label>4. åŠ å·¥</label><select class="form-control" id="ex-finish" onchange="calcPrice()"><option value="none">ç„¡åŠ å·¥</option><optgroup label="è£è¨‚"><option value="staple">é¨é¦¬é‡˜</option><option value="glue">è† è£</option><option value="ring">ç’°è£</option><option value="hardcover">ç²¾è£</option></optgroup><optgroup label="ç‰¹æ®ŠåŠ å·¥"><option value="glossy-lam">ä¸Šäº®è†œ</option><option value="matte-lam">ä¸Šéœ§è†œ</option><option value="spot-uv">å±€éƒ¨å…‰</option><option value="foil">ç‡™é‡‘</option><option value="round">å°åœ“è§’</option></optgroup></select></div>
                    </div>
                    <div class="form-group"><label>æ•¸é‡</label><input type="number" class="form-control" id="ex-qty" value="1" min="1" onchange="calcPrice()"></div>
                    <div class="upload-area"><input type="file" id="real-file" class="file-input" accept="image/*,.pdf" onchange="handleFileUpload(this)"><div id="upload-placeholder"><div style="font-size:2rem;">ğŸ“</div><h4>é»æ“Šä¸Šå‚³æª”æ¡ˆ</h4><p style="color:#999;">æ”¯æ´ PDF/JPG</p></div><div id="file-display" style="display:none;"><h4 id="filename-display" style="color:var(--primary);">filename.pdf</h4><div id="status-ok" class="status-box status-ok" style="display:none;">âœ… æª”æ¡ˆæ ¼å¼æ­£ç¢º</div></div></div>
                    <button id="preview-btn" class="preview-btn" style="background:var(--secondary); display:none;" onclick="openPreview()">ğŸ” é è¦½æª”æ¡ˆ</button>
                    <div class="price-box"><span style="display:block; font-size:0.9rem; color:#666;">é ä¼°åƒ¹æ ¼</span><div class="total-price" id="total-price">NT$ 0</div></div>
                    <button class="btn-primary" id="add-cart-btn" onclick="addToCart()" disabled>è«‹å…ˆé è¦½ä¸¦ç¢ºèª</button>
                </div>
            </div>

            <div id="checkout-view" class="hidden-section">
                <button class="back-btn" onclick="switchView('home')">â† å–æ¶ˆ</button>
                <div class="checkout-view">
                    <div class="checkout-header"><h2>ğŸ›’ ç¢ºèªè¨‚å–®èˆ‡ä»˜æ¬¾</h2></div>
                    <h3>è¨‚å–®æ˜ç´°</h3><div class="order-summary" id="checkout-list"></div>
                    <h3>æ”¶ä»¶è³‡è¨Š</h3><div class="form-grid"><div class="form-group"><label>å§“å</label><input type="text" id="checkout-name" class="form-control"></div><div class="form-group"><label>é›»è©± (09xxxxxxxx)</label><input type="text" id="checkout-phone" class="form-control"></div></div><div class="form-group"><label>Email</label><input type="email" id="checkout-email" class="form-control"></div>
                    <h3>é…é€æ–¹å¼</h3><div class="selection-card-group"><div class="selection-card active" id="del-pickup" onclick="selectDelivery('pickup')"><h4>ğŸª é–€å¸‚è‡ªå–</h4><p>å…è²»</p></div><div class="selection-card" id="del-delivery" onclick="selectDelivery('delivery')"><h4>ğŸšš å®…é…</h4><p>é‹è²»+$100</p></div></div>
                    <h3>ä»˜æ¬¾æ–¹å¼</h3><div class="selection-card-group"><div class="selection-card active" id="pay-store" onclick="selectPayment('store')"><h4>ğŸ’µ åˆ°åº—ä»˜æ¬¾</h4></div><div class="selection-card" id="pay-mobile" onclick="selectPayment('mobile')"><h4>ğŸ“± è¡Œå‹•æ”¯ä»˜</h4></div></div>
                    <div class="summary-total">ç¸½ä»˜æ¬¾é‡‘é¡: NT$ <span id="final-total">0</span></div>
                    <button class="btn-primary" onclick="submitOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
                </div>
            </div>

            <div id="my-orders-view" class="hidden-section">
                <div class="dashboard-container">
                    <h2>ğŸ‘¤ æˆ‘çš„è¨‚å–®ç´€éŒ„</h2>
                    <table class="order-table"><thead><tr><th>ID</th><th>å…§å®¹</th><th>é‡‘é¡</th><th>ç‹€æ…‹</th></tr></thead><tbody id="my-order-list"></tbody></table>
                    <div id="no-my-orders" style="text-align:center; padding:20px; color:#999; display:none;">å°šç„¡è¨‚å–®</div>
                </div>
            </div>

            <div id="admin-dashboard-view" class="hidden-section">
                <div class="dashboard-container">
                    <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><h2>ğŸ“Š ç®¡ç†è€…å¾Œå°</h2><button onclick="logout()" style="padding:5px 15px;">ç™»å‡º</button></div>
                    <div class="admin-tabs"><div class="admin-tab active" onclick="switchAdminTab('orders')">è¨‚å–®ç®¡ç†</div><div class="admin-tab" onclick="switchAdminTab('users')">æœƒå“¡ç®¡ç†</div></div>
                    <div id="admin-tab-orders"><table class="order-table"><thead><tr><th>è¨‚è³¼äºº (é›»è©±)</th><th>å…§å®¹</th><th>é…é€</th><th>é‡‘é¡</th><th>ç‹€æ…‹ç®¡ç†</th></tr></thead><tbody id="admin-order-list"></tbody></table></div>
                    <div id="admin-tab-users" style="display:none;"><table class="order-table"><thead><tr><th>å¸³è™Ÿ</th><th>å§“å</th><th>é›»è©±</th><th>Email</th><th>æ“ä½œ</th></tr></thead><tbody id="admin-user-list"></tbody></table></div>
                </div>
            </div>
        </div>
    </div>

    <div id="preview-modal" class="modal-overlay"><div class="modal-content"><div class="modal-body"><h3>æª”æ¡ˆé è¦½</h3><div class="preview-container"><img id="preview-img-src" class="preview-img"><iframe id="preview-pdf-src" class="preview-pdf"></iframe></div><button class="btn-primary" style="max-width:300px; background:var(--success);" onclick="confirmPreview()">ç¢ºèªç„¡èª¤</button><button style="margin-top:10px; background:none; border:none;" onclick="document.getElementById('preview-modal').style.display='none'">é—œé–‰</button></div></div></div>
    <div id="cart-sidebar" class="cart-sidebar"><div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding-bottom:10px;"><h3>ğŸ›’ è³¼ç‰©è»Š</h3><button onclick="toggleCart()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button></div><div id="cart-items" style="flex:1; overflow-y:auto; padding-top:10px;"></div><div style="border-top:1px solid #eee; padding-top:20px;"><div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2rem; margin-bottom:10px;"><span>ç¸½è¨ˆ</span><span id="cart-total-display">NT$ 0</span></div><button class="btn-primary" onclick="goToCheckout()">å‰å¾€çµå¸³</button></div></div>
    <a href="#" class="footer-admin-link" onclick="logout(); toggleAuth('login');">ç®¡ç†è€…ç™»å…¥</a>

    <script>
        // --- 1. LocalStorage Persistence Logic ---
        function loadData() {
            const users = localStorage.getItem('cmykb_users');
            const orders = localStorage.getItem('cmykb_orders');
            if(users) USERS_DB = JSON.parse(users);
            if(orders) ORDERS_DB = JSON.parse(orders);
        }
        function saveData() {
            localStorage.setItem('cmykb_users', JSON.stringify(USERS_DB));
            localStorage.setItem('cmykb_orders', JSON.stringify(ORDERS_DB));
        }
        function resetData() {
            if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—ï¼Ÿ(å°‡ç™»å‡º)')) {
                localStorage.removeItem('cmykb_users');
                localStorage.removeItem('cmykb_orders');
                location.reload();
            }
        }

        // Default Data
        let USERS_DB = [{user:'admin',pass:'1234',role:'admin',name:'Admin',phone:'',email:''},{user:'user',pass:'1234',role:'user',name:'DemoUser',phone:'0912345678',email:'demo@mail.com'}];
        let ORDERS_DB = [];
        loadData(); // Load on init

        let currentUser=null, cart=[], fileURL=null, fileType='image', checkoutState={delivery:'pickup',payment:'store'}, currentCartTotal=0, wizardState={purpose:'',waterproof:'',texture:''};

        // Prices & Lib
        const PRICES = {base_A4:3,base_A3:8,base_A5:2,base_A2:50,base_B4:5,base_B5:2,base_B3:40,base_A1:200,base_A0:400,base_Postcard:5,base_Envelope:10,base_NameCard:99,mat_plain:0,mat_woodfree:1,mat_glossy:2,mat_matte:3,mat_card_copper:5,mat_ivory:10,mat_kraft:5,mat_pearl:30,mat_pp:50,mat_sticker_mold:10,mat_sticker_glossy:15,mat_sticker_trans:25,finish_none:0,finish_staple:5,finish_glue:20,finish_ring:25,finish_hardcover:100,finish_glossy_lam:10,finish_matte_lam:15,finish_spot_uv:50,finish_foil:80,finish_round:30,color_bw:1,color_color:4};
        const LIB_DATA = {size:[{t:"A4",d:"210x297mm",icon:"ğŸ“„"},{t:"A3",d:"297x420mm",icon:"ğŸ“‘"},{t:"A5",d:"148x210mm",icon:"ğŸ“"},{t:"A2",d:"420x594mm",icon:"ğŸ“œ"},{t:"A1/A0",d:"å¤§åœ–è¼¸å‡º",icon:"ğŸ–¼ï¸"},{t:"B4/B5",d:"è©¦å·/æ›¸ç±",icon:"ğŸ“’"},{t:"åç‰‡",d:"90x54mm",icon:"ğŸªª"},{t:"ä¿¡å°",d:"12K/15K",icon:"âœ‰ï¸"}],material:[{t:"æ™®é€šç´™",val:"plain",d:"ä¾¿å®œæ–‡ä»¶",css:"background:white;"},{t:"éŠ…ç‰ˆç´™",val:"glossy",d:"äº®é¢å‚³å–®",css:"tex-glossy"},{t:"é›ªéŠ…ç´™",val:"matte",d:"éœ§é¢ç•«å†Š",css:"tex-matte"},{t:"éŠ…è¥¿å¡",val:"card_copper",d:"åŠ åšå¡ç´™",css:"background:#fff;border:2px solid #eee;"},{t:"è±¡ç‰™å¡",val:"ivory",d:"æ‰‹æ„Ÿç´®å¯¦",css:"background:#fffbf0;"},{t:"ç‰›çš®ç´™",val:"kraft",d:"å¾©å¤é¢¨æ ¼",css:"tex-kraft"},{t:"æ˜Ÿå¹»ç´™",val:"pearl",d:"ç å…‰è³ªæ„Ÿ",css:"tex-pearl"},{t:"è²¼ç´™",val:"sticker_glossy",d:"éŠ…ç‰ˆ/é€æ˜",css:"background:#eee;"}],finish:[{t:"é¨é¦¬é‡˜",val:"staple",icon:"ğŸ“"},{t:"è† è£",val:"glue",icon:"ğŸ“š"},{t:"ç’°è£",val:"ring",icon:"ğŸ“’"},{t:"ç²¾è£",val:"hardcover",icon:"ğŸ“•"},{t:"ä¸Šäº®/éœ§è†œ",val:"glossy-lam",icon:"âœ¨"},{t:"ç‡™é‡‘",val:"foil",icon:"âšœï¸"},{t:"å±€éƒ¨å…‰",val:"spot-uv",icon:"ğŸ”¦"},{t:"å°åœ“è§’",val:"round",icon:"ğŸ”²"}]};

        // Auth
        function toggleAuth(m){document.querySelectorAll('.auth-tab').forEach(e=>e.classList.remove('active'));document.querySelectorAll('.auth-form').forEach(e=>e.style.display='none');document.getElementById('tab-'+m).classList.add('active');document.getElementById('form-'+m).style.display='block';}
        function register(){
            const u=document.getElementById('reg-user').value, p=document.getElementById('reg-pass').value, n=document.getElementById('reg-name').value, ph=document.getElementById('reg-phone').value, em=document.getElementById('reg-email').value;
            if(!u||!p||!n){alert("è³‡æ–™ä¸å®Œæ•´");return;}
            if(USERS_DB.find(x=>x.user===u)){alert("å¸³è™Ÿé‡è¤‡");return;}
            USERS_DB.push({user:u,pass:p,role:'user',name:n,phone:ph,email:em});
            saveData(); alert("è¨»å†ŠæˆåŠŸ"); toggleAuth('login');
        }
        function login(){
            const u=document.getElementById('login-user').value, p=document.getElementById('login-pass').value;
            const user=USERS_DB.find(x=>x.user===u && x.pass===p);
            if(user){currentUser=user;document.getElementById('auth-view').style.display='none';document.getElementById('app-view').style.display='block';document.getElementById('display-username').innerText=`Hi, ${user.name}`;if(user.role==='admin'){switchView('admin');document.querySelector('.header-actions').style.display='none';}else{switchView('home');document.querySelector('.header-actions').style.display='flex';}}else{document.getElementById('auth-msg').innerText="å¸³è™Ÿå¯†ç¢¼éŒ¯èª¤";document.getElementById('auth-msg').style.display='block';}
        }
        function logout(){currentUser=null;location.reload();}

        // Nav
        function switchView(v){
            document.querySelectorAll('.hidden-section, #home-view').forEach(e=>e.style.display='none');
            if(v==='home')document.getElementById('home-view').style.display='block';
            if(v==='order'){document.getElementById('expert-mode').style.display='block';calcPrice();}
            if(v==='library'){document.getElementById('library-view').style.display='block';filterLib('size');}
            if(v==='checkout'){document.getElementById('checkout-view').style.display='block';renderCheckout();}
            if(v==='my-orders'){document.getElementById('my-orders-view').style.display='block';renderUserOrders();}
            if(v==='admin'){document.getElementById('admin-dashboard-view').style.display='block';renderAdminOrders();renderAdminUsers();}
        }
        function startWizard(){switchView('wizard');document.getElementById('wizard-mode').style.display='block';wizardReset();}
        function startExpert(){switchView('order');}

        // Library
        function filterLib(t){document.querySelectorAll('.lib-tab').forEach(e=>e.classList.remove('active'));event.target.classList.add('active');const g=document.getElementById('lib-content');g.innerHTML="";LIB_DATA[t].forEach(i=>{let v=i.icon?`<div style="font-size:3rem;">${i.icon}</div>`:`<div class="texture-demo ${i.css}" style="${i.css}">æè³ª</div>`;let b=i.val?`<button class="use-btn" onclick="useSpec('${t}','${i.val}')">é¸ç”¨ â”</button>`:'';g.innerHTML+=`<div class="spec-card">${v}<div class="spec-title">${i.t}</div><div class="spec-desc">${i.d}</div>${b}</div>`;});}
        function useSpec(t,v){switchView('order');if(t==='material')document.getElementById('ex-material').value=v;if(t==='finish')document.getElementById('ex-finish').value=v;calcPrice();}

        // Wizard
        function wizardReset(){document.getElementById('chat-window').innerHTML=`<div class="message bot">ä½ å¥½ï¼æˆ‘æ˜¯å°åˆ·å°å¹«æ‰‹ã€‚<br><b>Q1. è«‹å•æ‚¨çš„å°åˆ·ç”¨é€”æ˜¯ï¼Ÿ</b></div>`;document.getElementById('chat-options').innerHTML=`<button class="option-btn" onclick="wizardStep(1,'flyer')">ç™¼å‚³å–®</button><button class="option-btn" onclick="wizardStep(1,'poster')">è²¼æµ·å ±</button><button class="option-btn" onclick="wizardStep(1,'card')">æ›åç‰‡</button>`;}
        function wizardStep(s,v){const w=document.getElementById('chat-window');w.innerHTML+=`<div class="message user" style="float:right;clear:both;">${v}</div>`;if(s===1){setTimeout(()=>{w.innerHTML+=`<div class="message bot" style="clear:both;"><b>Q2. å–œæ­¡äº®é¢é‚„æ˜¯éœ§é¢ï¼Ÿ</b></div>`;document.getElementById('chat-options').innerHTML=`<button class="option-btn" onclick="wizardEnd('A4','glossy','none')">äº®é¢</button><button class="option-btn" onclick="wizardEnd('A4','matte','none')">éœ§é¢</button>`;},500);}}
        function wizardEnd(s,m,f){setTimeout(()=>{switchView('order');document.getElementById('ex-size').value=s;document.getElementById('ex-material').value=m;document.getElementById('ex-finish').value=f;calcPrice();},1000);}

        // Order
        function calcPrice(){const s=document.getElementById('ex-size').value,c=document.getElementById('ex-color').value,m=document.getElementById('ex-material').value,f=document.getElementById('ex-finish').value,q=document.getElementById('ex-qty').value;let b=PRICES['base_'+s]||10;let u=(b*(c==='color'?4:1))+(PRICES['mat_'+m]||0)+(PRICES['finish_'+f]||0);if(s==='NameCard')u=PRICES.base_NameCard+(PRICES['mat_'+m]||0);document.getElementById('total-price').innerText="NT$ "+(u*q);return u*q;}
        function handleFileUpload(i){if(i.files[0]){const f=i.files[0];document.getElementById('upload-placeholder').style.display='none';document.getElementById('file-display').style.display='block';document.getElementById('filename-display').innerText=f.name;document.getElementById('status-ok').style.display='block';if(f.type.match('image.*')){let r=new FileReader();r.onload=e=>{fileURL=e.target.result;};r.readAsDataURL(f);fileType='image';}else{fileURL=URL.createObjectURL(f);fileType='pdf';}document.getElementById('preview-btn').style.display='block';}}
        function openPreview(){const i=document.getElementById('preview-img-src'),p=document.getElementById('preview-pdf-src');if(fileType==='image'){i.src=fileURL;i.style.display='block';p.style.display='none';}else{p.src=fileURL;p.style.display='block';i.style.display='none';}document.getElementById('preview-modal').style.display='flex';}
        function confirmPreview(){document.getElementById('preview-modal').style.display='none';const b=document.getElementById('add-cart-btn');b.disabled=false;b.innerText="åŠ å…¥è³¼ç‰©è»Š";b.style.backgroundColor="#28a745";}
        function toggleCart(){document.getElementById('cart-sidebar').classList.toggle('open');}
        function addToCart(){const s=document.getElementById('ex-size'),c=document.getElementById('ex-color'),m=document.getElementById('ex-material');cart.push({desc:`${s.options[s.selectedIndex].text}/${c.options[c.selectedIndex].text}/${m.options[m.selectedIndex].text}`,qty:document.getElementById('ex-qty').value,price:calcPrice()});updateCartUI();toggleCart();}
        function updateCartUI(){document.getElementById('cart-count').innerText=cart.length;const c=document.getElementById('cart-items');c.innerHTML="";let t=0;cart.forEach(i=>{t+=i.price;c.innerHTML+=`<div style='background:#f9f9f9;padding:10px;margin-bottom:5px;'><b>${i.desc}</b><br>Qty:${i.qty} | $${i.price}</div>`;});document.getElementById('cart-total-display').innerText="NT$ "+t;}

        // Checkout
        function goToCheckout(){if(cart.length===0){alert('ç©ºè»Š');return;}toggleCart();switchView('checkout');}
        function renderCheckout(){
            const l=document.getElementById('checkout-list');l.innerHTML="";let sub=0;
            cart.forEach(i=>{sub+=i.price;l.innerHTML+=`<div class="summary-item"><div>${i.desc}(x${i.qty})</div><div>$${i.price}</div></div>`;});
            document.getElementById('checkout-name').value=currentUser.name||"";document.getElementById('checkout-phone').value=currentUser.phone||"";document.getElementById('checkout-email').value=currentUser.email||"";
            updateFinalTotal(sub);
        }
        function selectDelivery(t){checkoutState.delivery=t;updateUI();}
        function selectPayment(t){checkoutState.payment=t;updateUI();}
        function updateUI(){['del-pickup','del-delivery'].forEach(i=>document.getElementById(i).classList.remove('active'));['pay-store','pay-mobile'].forEach(i=>document.getElementById(i).classList.remove('active'));document.getElementById('del-'+checkoutState.delivery).classList.add('active');document.getElementById('pay-'+checkoutState.payment).classList.add('active');let s=0;cart.forEach(i=>s+=i.price);updateFinalTotal(s);}
        function updateFinalTotal(s){let sh=checkoutState.delivery==='delivery'?100:0;currentCartTotal=s+sh;document.getElementById('final-total').innerText=currentCartTotal;}
        function validatePhone(p){return /^(09\d{8}|0\d{1,2}-?\d{6,8})$/.test(p);}
        function validateEmail(e){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);}
        function submitOrder(){
            const n=document.getElementById('checkout-name').value, p=document.getElementById('checkout-phone').value, e=document.getElementById('checkout-email').value;
            if(!n||!p||!e){alert("è³‡æ–™ä¸å…¨");return;} if(!validatePhone(p)){alert("é›»è©±æ ¼å¼éŒ¯");return;} if(!validateEmail(e)){alert("EmailéŒ¯");return;}
            let ord={id:'2025-'+Math.floor(Math.random()*9999),user:currentUser.user,userName:n,userPhone:p,items:cart.map(i=>i.desc).join('<br>'),info:`${checkoutState.delivery}/${checkoutState.payment}`,total:currentCartTotal,status:'æ–°è¨‚å–®'};
            ORDERS_DB.push(ord); saveData(); cart=[]; updateCartUI(); alert('è¨‚å–®å·²é€å‡º'); switchView('my-orders');
        }

        // Admin & User Dash
        function renderUserOrders(){const b=document.getElementById('my-order-list');b.innerHTML="";const m=ORDERS_DB.filter(o=>o.user===currentUser.user).reverse();document.getElementById('no-my-orders').style.display=m.length===0?'block':'none';m.forEach(o=>{let c=o.status==='å·²å®Œæˆ'?'status-done':(o.status==='æ–°è¨‚å–®'?'status-new':'status-processing');b.innerHTML+=`<tr><td>#${o.id}</td><td>${o.items}</td><td>${o.info}</td><td>$${o.total}</td><td><span class="status-badge ${c}">${o.status}</span></td></tr>`;});}
        function switchAdminTab(t){document.querySelectorAll('.admin-tab').forEach(e=>e.classList.remove('active'));event.target.classList.add('active');document.getElementById('admin-tab-orders').style.display=t==='orders'?'block':'none';document.getElementById('admin-tab-users').style.display=t==='users'?'block':'none';}
        function renderAdminOrders(){const b=document.getElementById('admin-order-list');b.innerHTML="";[...ORDERS_DB].reverse().forEach((o,i)=>{let s=`<select class="status-select" onchange="updateOrderStatus(${ORDERS_DB.length-1-i},this.value)"><option value="æ–°è¨‚å–®" ${o.status==='æ–°è¨‚å–®'?'selected':''}>æ–°è¨‚å–®</option><option value="å°è£½ä¸­" ${o.status==='å°è£½ä¸­'?'selected':''}>å°è£½ä¸­</option><option value="å·²å®Œæˆ" ${o.status==='å·²å®Œæˆ'?'selected':''}>å·²å®Œæˆ</option></select>`;b.innerHTML+=`<tr><td>${o.userName}<br><small>${o.userPhone}</small></td><td>${o.items}</td><td>${o.info}</td><td style='color:red;'>$${o.total}</td><td>${s}</td></tr>`;});}
        function updateOrderStatus(i,v){ORDERS_DB[i].status=v;saveData();alert("ç‹€æ…‹å·²æ›´æ–°");}
        function renderAdminUsers(){const b=document.getElementById('admin-user-list');b.innerHTML="";USERS_DB.forEach((u,i)=>{let btn=u.role==='admin'?'-':`<button class="delete-btn" onclick="deleteUser(${i})">åˆªé™¤</button>`;b.innerHTML+=`<tr><td>${u.user}</td><td>${u.name}</td><td>${u.phone}</td><td>${u.email}</td><td>${btn}</td></tr>`;});}
        function deleteUser(i){if(confirm('åˆªé™¤?')){USERS_DB.splice(i,1);saveData();renderAdminUsers();}}
    </script>
</body>

</html>
